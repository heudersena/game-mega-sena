"use strict";var T=Object.create;var u=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var n=(e,t)=>u(e,"name",{value:t,configurable:!0});var V=(e,t)=>{for(var s in t)u(e,s,{get:t[s],enumerable:!0})},L=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of $(t))!K.call(e,a)&&a!==s&&u(e,a,{get:()=>t[a],enumerable:!(r=U(t,a))||r.enumerable});return e};var j=(e,t,s)=>(s=e!=null?T(k(e)):{},L(t||!e||!e.__esModule?u(s,"default",{value:e,enumerable:!0}):s,e)),z=e=>L(u({},"__esModule",{value:!0}),e);var A=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)};var m=(e,t,s)=>(A(e,t,"read from private field"),s?s.call(e):t.get(e)),E=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},b=(e,t,s,r)=>(A(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s);var o=(e,t,s)=>new Promise((r,a)=>{var c=i=>{try{g(s.next(i))}catch(C){a(C)}},M=i=>{try{g(s.throw(i))}catch(C){a(C)}},g=i=>i.done?r(i.value):Promise.resolve(i.value).then(c,M);g((s=s.apply(e,t)).next())});var N={};V(N,{ResetPasswordController:()=>F});module.exports=z(N);var H=require("@prisma/client"),l=new H.PrismaClient;l.$disconnect();var I=require("uuid");var q=require("dotenv/config"),P=j(require("nodemailer"));var D=P.default.createTransport({service:"gmail",port:587,auth:{user:"programadorwebti@gmail.com",pass:process.env.EMAIL_KEY},tls:{rejectUnauthorized:!0,minVersion:"TLSv1.2"}}),d,p,h,w,R=(w=class{constructor({to:t,title:s,body:r}){E(this,d,void 0);E(this,p,void 0);E(this,h,void 0);b(this,d,t),b(this,p,s),b(this,h,r)}send(){return o(this,null,function*(){let t={from:m(this,d),to:m(this,d),bcc:"heuder.sicoob@gmail.com",subject:m(this,p),html:m(this,h)};D.sendMail(t,function(s,r){return s||r})})}},d=new WeakMap,p=new WeakMap,h=new WeakMap,n(w,"CLASSSendEmail"),w);var v=j(require("bcrypt"));var f,_=(f=class{static CreatedHash(t){return o(this,null,function*(){let s=v.default.genSaltSync(10);return v.default.hashSync(t,s)})}},n(f,"PasswordHash"),f);var y,x=(y=class{static update(t,s){return o(this,null,function*(){let r=yield l.user.findFirst({where:{recover_password:t}}),a=yield _.CreatedHash(s);if(r!=null){let c=yield l.user.update({where:{id:String(r==null?void 0:r.id)},data:{password:a}});return{status:!0}}else return{status:!1}})}static handle(t){return o(this,null,function*(){let s=(0,I.v4)();(yield l.user.findUnique({where:{email:t}}))&&(yield l.user.update({where:{email:t},data:{recover_password:s}}).then(a=>{let c=process.env.LINK_EMAIL_RECOVER;new R({to:t,title:"Recupere sua senha",body:`${c}/recover-password/${s}`}).send()}))})}},n(y,"CheckExistEmail"),y);var S,F=(S=class{static handle(t,s){return o(this,null,function*(){let r=t.body.email;console.log(r);try{let a=yield x.handle(r);return s.status(200).json({content:a,status:!0})}catch(a){return s.json({error:a,status:!1})}})}static handleExecute(t,s){return o(this,null,function*(){let r=t.params.uuid,a=t.params.new_password,c=yield x.update(String(r),String(a));s.json(c)})}},n(S,"ResetPasswordController"),S);0&&(module.exports={ResetPasswordController});
