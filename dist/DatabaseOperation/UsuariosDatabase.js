"use strict";var G=Object.create;var p=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var n=(a,t)=>p(a,"name",{value:t,configurable:!0});var J=(a,t)=>{for(var s in t)p(a,s,{get:t[s],enumerable:!0})},N=(a,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of V(t))!q.call(a,e)&&e!==s&&p(a,e,{get:()=>t[e],enumerable:!(r=K(t,e))||r.enumerable});return a};var R=(a,t,s)=>(s=a!=null?G(j(a)):{},N(t||!a||!a.__esModule?p(s,"default",{value:a,enumerable:!0}):s,a)),$=a=>N(p({},"__esModule",{value:!0}),a);var y=(a,t,s)=>{if(!t.has(a))throw TypeError("Cannot "+s)};var u=(a,t,s)=>(y(a,t,"read from private field"),s?s.call(a):t.get(a)),O=(a,t,s)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,s)},f=(a,t,s,r)=>(y(a,t,"write to private field"),r?r.call(a,s):t.set(a,s),s);var i=(a,t,s)=>new Promise((r,e)=>{var o=E=>{try{g(s.next(E))}catch(L){e(L)}},d=E=>{try{g(s.throw(E))}catch(L){e(L)}},g=E=>E.done?r(E.value):Promise.resolve(E.value).then(o,d);g((s=s.apply(a,t)).next())});var Y={};J(Y,{UsuariosDatabase:()=>B});module.exports=$(Y);var x=require("uuid"),P=require("bcrypt");var D=require("@prisma/client"),c=new D.PrismaClient;c.$disconnect();var T=R(require("bcrypt"));var l,U=(l=class{static CreatedHash(t){return i(this,null,function*(){let s=T.default.genSaltSync(10);return T.default.hashSync(t,s)})}},n(l,"PasswordHash"),l);var I="OPERA\xC7\xC3O EXECUTADA COM SUCESSO.".trim(),M="OPS! OCORREU ALGUM ERRO NO SISTEMA.".trim(),S=n(a=>a.toUpperCase().trim(),"MESSAGE_CUSTOM");var X=R(require("jsonwebtoken"));var et=require("dotenv/config"),H=R(require("nodemailer"));var k=H.default.createTransport({service:"gmail",port:587,auth:{user:"programadorwebti@gmail.com",pass:process.env.EMAIL_KEY},tls:{rejectUnauthorized:!0,minVersion:"TLSv1.2"}}),m,A,w,_,v=(_=class{constructor({to:t,title:s,body:r}){O(this,m,void 0);O(this,A,void 0);O(this,w,void 0);f(this,m,t),f(this,A,s),f(this,w,r)}send(){return i(this,null,function*(){let t={from:u(this,m),to:u(this,m),bcc:"heuder.sicoob@gmail.com",subject:u(this,A),html:u(this,w)};k.sendMail(t,function(s,r){return s||r})})}},m=new WeakMap,A=new WeakMap,w=new WeakMap,n(_,"CLASSSendEmail"),_);var b=require("crypto");var h,F=(h=class{static code(){return i(this,null,function*(){return this._FN_LOCAL_REGENERATED()})}static _FN_LOCAL_REGENERATED(){return i(this,null,function*(){return(0,b.randomUUID)().split("-")[0].substring(0,4).toUpperCase()})}},n(h,"CodeUnique"),h);var C,B=(C=class{static register(t,s,r){return i(this,null,function*(){try{if(yield this._FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t))return{status:!1,message:S("ESSE EMAIL J\xC1 EXISTE NA BASE DE DADOS."),data:[]};{let e=yield U.CreatedHash(s),o=r=="SELLER"?yield F.code():"",d=yield c.user.create({data:{email:t,password:e,access_role:r,code_ref_user:String(o)}});return d?{status:!1,message:I,data:d}:{status:!0,message:M,data:d}}}catch(e){return{status:!0,message:e,data:[]}}})}static login(t,s){return i(this,null,function*(){let r=process.env.JWT_STRING,e=yield c.user.findFirst({where:{email:t},include:{Establishment:{select:{id:!0}}}});if((0,P.compareSync)(s,String(e==null?void 0:e.password))){e==null||delete e.password,e==null||delete e.recover_password,e==null||delete e.is_active,e==null||delete e.created_at,e==null||delete e.updated_at;let d=X.default.sign({user:JSON.stringify(e)},String(r),{expiresIn:"60m"});return{status:!1,message:I,data:{token:d,user:e}}}return{status:!0,message:S("E-MAIL OU SENHA INV\xC1LIDOS."),data:[]}})}static recovery_password(t){return i(this,null,function*(){if(!(yield this._FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t)))return{status:!0,message:S("E-MAIL INEXISTENTE NA BASE DE DADOS"),data:[]};let r=(0,x.v4)(),e=yield c.user.update({where:{email:t},data:{recover_password:r}});yield new v({to:t,title:`RECUPERA SUA SENHA ${new Date().toTimeString()}`,body:`http://192.168.0.111:4008/v1/recover-password/${r}`}).send().then(o=>({status:!1,message:I,data:o})).catch(o=>(console.log(o),{status:!0,message:S("ERROR AO ENVIAR O E-MAIL"),data:[]}))})}static update_password(t,s){return i(this,null,function*(){let r=yield c.user.findFirst({where:{recover_password:t}});if(!r)return{status:!0,message:S("O C\xD3DIGO N\xC3O EXISTE OU EST\xC1 EXPIRADAO."),data:[]};let e=yield U.CreatedHash(s),o=yield c.user.update({where:{id:r==null?void 0:r.id},data:{password:e,recover_password:""}});return o==null||delete o.password,{status:!1,message:S("SENHA ATUALIZADA COM SUCESSO."),data:o}})}static _FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t){return i(this,null,function*(){return!!(yield c.user.findUnique({where:{email:t}}))})}},n(C,"UsuariosDatabase"),C);0&&(module.exports={UsuariosDatabase});
