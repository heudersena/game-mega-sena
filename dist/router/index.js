"use strict";var Rt=Object.create;var g=Object.defineProperty;var Tt=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Ut=Object.getPrototypeOf,Lt=Object.prototype.hasOwnProperty;var m=(o,t)=>g(o,"name",{value:t,configurable:!0});var xt=(o,t)=>{for(var e in t)g(o,e,{get:t[e],enumerable:!0})},at=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Dt(t))!Lt.call(o,s)&&s!==e&&g(o,s,{get:()=>t[s],enumerable:!(r=Tt(t,s))||r.enumerable});return o};var q=(o,t,e)=>(e=o!=null?Rt(Ut(o)):{},at(t||!o||!o.__esModule?g(e,"default",{value:o,enumerable:!0}):e,o)),Mt=o=>at(g({},"__esModule",{value:!0}),o);var ot=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var w=(o,t,e)=>(ot(o,t,"read from private field"),e?e.call(o):t.get(o)),X=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},K=(o,t,e,r)=>(ot(o,t,"write to private field"),r?r.call(o,e):t.set(o,e),e);var n=(o,t,e)=>new Promise((r,s)=>{var a=d=>{try{u(e.next(d))}catch(i){s(i)}},c=d=>{try{u(e.throw(d))}catch(i){s(i)}},u=d=>d.done?r(d.value):Promise.resolve(d.value).then(a,c);u((e=e.apply(o,t)).next())});var Ht={};xt(Ht,{r:()=>h});module.exports=Mt(Ht);var It=require("express");var $=q(require("moment"));var nt=require("@prisma/client"),l=new nt.PrismaClient;l.$disconnect();function it(){let o=[];for(let r=1;r<=60;r++)o.push(r);for(let r=o.length-1;r>0;r--){let s=Math.floor(Math.random()*(r+1));[o[r],o[s]]=[o[s],o[r]]}return o.slice(0,35).sort((r,s)=>r-s)}m(it,"generateUniqueNumbers12");var E="OPERA\xC7\xC3O EXECUTADA COM SUCESSO.".trim(),S="OPS! OCORREU ALGUM ERRO NO SISTEMA.".trim(),f=m(o=>o.toUpperCase().trim(),"MESSAGE_CUSTOM");var y,ct=(y=class{static create(t,e){return n(this,null,function*(){try{let r=yield l.game.findFirst({orderBy:{created_at:"desc"}}),s=r!=null&&r.match_id?(r==null?void 0:r.match_id)+1:1,a=yield l.bet.findFirst({orderBy:{created_at:"desc"}}),c=a!=null&&a.namber_bet?(a==null?void 0:a.namber_bet)+1:1,u=String(t||it()),d=yield this._FN_LOCAL_CREATE_BET(s,u,e,c);return{status:!1,message:E,data:d}}catch(r){return{status:!0,message:r,data:[]}}})}static searchForTheLastGame(){return n(this,null,function*(){var a,c;let t=yield l.$queryRaw`CALL PROCEDURE_GAMES('um')`;console.log("VIEW_BUSCAR_ULTIMO_REGISTRO_TABLE_GAMES: ",t);let e=(c=(a=t[0])==null?void 0:a.created_at)!=null?c:new Date,r=(0,$.default)(e).format("HH:mm:ss"),s=(0,$.default)(e).add(2,"minutes").format("HH:mm:ss");return{hora_database:r,horaAtualida:s}})}static _FN_LOCAL_CREATE_BET(t,e,r,s){return n(this,null,function*(){try{return yield l.bet.create({data:{number_game_result:String(t),numbers:String(e),establishmentId:r},include:{establishment:{select:{name:!0}}}})}catch(a){return a}})}},m(y,"JogosDatabase"),y);var C,mt=(C=class{static create(t,e){return n(this,null,function*(){var r;try{let{numbers:s,quantidade:a}=t.body,c=t.user.Establishment[0].id,u=parseInt(a!=null?a:1),d=[];for(let i=0;i<u;i++){let p=yield ct.create(s,c);d.push(p)}e.json({content:d})}catch(s){e.json(((r=s==null?void 0:s.meta)==null?void 0:r.target)=="bets_namber_bet_key"?"Tente novamente!":s)}})}},m(C,"BetController"),C);var A,lt=(A=class{static winners(t,e){return n(this,null,function*(){return yield l.bet.update({where:{id:e},data:{awarded:!0,status:"FINISHED",hits:t},include:{establishment:!0}})})}static losers(t){return n(this,null,function*(){return yield l.bet.update({where:{id:t},data:{status:"FINISHED"}})})}},m(A,"UpdateValuesTableBet"),A);var N,W=(N=class{static maior(t,e){return n(this,null,function*(){let r=String(t.query.n),s=yield l.bet.findMany({where:{number_game_result:{equals:r},AND:{awarded:{equals:!0}}},take:8,orderBy:{hits_round:"desc"},include:{establishment:{select:{name:!0}}}});e.json({quantity:s.length,comments:s})})}static check(t,e){return n(this,null,function*(){let r=[],s=t.params.numbers.split(",").map(u=>Number(u)),a=yield l.bet.findMany();if(a.length<=0)return e.json({resultados:r,ganhadores:[]});let c=0;a.forEach((u,d)=>n(this,null,function*(){for(let i of u.numbers.split(",").map(p=>Number(p)))s.includes(i)&&c++;c>=4?(console.log(u.numbers,c),lt.winners(c,u.id).then(i=>{r.push({id:u.id,numeros:u.numbers,correspondencias:c,aposta:i})})):yield l.bet.update({where:{id:u.id},data:{status:"FINISHED"}})})),e.json({})})}static bkp(t,e){return n(this,null,function*(){let r=[],s=[1,4,4,48,24,60],a=yield l.bet.findMany(),c=yield l.bet.count(),u=0;for(let d=0;d<a.length;d++){let i=a[d].numbers.split(","),p=!0;for(let b=0;b<6;b++)if(console.log(a[d][b]),Number(i[b])!==s[b]){p=!1;break}else console.log(i)}e.json("ok")})}},m(N,"CheckBetController"),N);var ht=require("uuid"),Et=require("bcrypt");var Y=q(require("bcrypt"));var I,z=(I=class{static CreatedHash(t){return n(this,null,function*(){let e=Y.default.genSaltSync(10);return Y.default.hashSync(t,e)})}},m(I,"PasswordHash"),I);var St=q(require("jsonwebtoken"));var ie=require("dotenv/config"),ut=q(require("nodemailer"));var Ft=ut.default.createTransport({service:"gmail",port:587,auth:{user:"programadorwebti@gmail.com",pass:process.env.EMAIL_KEY},tls:{rejectUnauthorized:!0,minVersion:"TLSv1.2"}}),_,v,O,R,dt=(R=class{constructor({to:t,title:e,body:r}){X(this,_,void 0);X(this,v,void 0);X(this,O,void 0);K(this,_,t),K(this,v,e),K(this,O,r)}send(){return n(this,null,function*(){let t={from:w(this,_),to:w(this,_),bcc:"heuder.sicoob@gmail.com",subject:w(this,v),html:w(this,O)};Ft.sendMail(t,function(e,r){return e||r})})}},_=new WeakMap,v=new WeakMap,O=new WeakMap,m(R,"CLASSSendEmail"),R);var pt=require("crypto");var T,bt=(T=class{static code(){return n(this,null,function*(){return this._FN_LOCAL_REGENERATED()})}static _FN_LOCAL_REGENERATED(){return n(this,null,function*(){return(0,pt.randomUUID)().split("-")[0].substring(0,4).toUpperCase()})}},m(T,"CodeUnique"),T);var D,U=(D=class{static register(t,e,r){return n(this,null,function*(){try{if(yield this._FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t))return{status:!1,message:f("ESSE EMAIL J\xC1 EXISTE NA BASE DE DADOS."),data:[]};{let s=yield z.CreatedHash(e),a=r=="SELLER"?yield bt.code():"",c=yield l.user.create({data:{email:t,password:s,access_role:r,code_ref_user:String(a)}});return c?{status:!1,message:E,data:c}:{status:!0,message:S,data:c}}}catch(s){return{status:!0,message:s,data:[]}}})}static login(t,e){return n(this,null,function*(){let r=process.env.JWT_STRING,s=yield l.user.findFirst({where:{email:t},include:{Establishment:{select:{id:!0}}}});if((0,Et.compareSync)(e,String(s==null?void 0:s.password))){s==null||delete s.password,s==null||delete s.recover_password,s==null||delete s.is_active,s==null||delete s.created_at,s==null||delete s.updated_at;let c=St.default.sign({user:JSON.stringify(s)},String(r),{expiresIn:"60m"});return{status:!1,message:E,data:{token:c,user:s}}}return{status:!0,message:f("E-MAIL OU SENHA INV\xC1LIDOS."),data:[]}})}static recovery_password(t){return n(this,null,function*(){if(!(yield this._FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t)))return{status:!0,message:f("E-MAIL INEXISTENTE NA BASE DE DADOS"),data:[]};let r=(0,ht.v4)(),s=yield l.user.update({where:{email:t},data:{recover_password:r}});yield new dt({to:t,title:`RECUPERA SUA SENHA ${new Date().toTimeString()}`,body:`http://192.168.0.111:4008/v1/recover-password/${r}`}).send().then(a=>({status:!1,message:E,data:a})).catch(a=>(console.log(a),{status:!0,message:f("ERROR AO ENVIAR O E-MAIL"),data:[]}))})}static update_password(t,e){return n(this,null,function*(){let r=yield l.user.findFirst({where:{recover_password:t}});if(!r)return{status:!0,message:f("O C\xD3DIGO N\xC3O EXISTE OU EST\xC1 EXPIRADAO."),data:[]};let s=yield z.CreatedHash(e),a=yield l.user.update({where:{id:r==null?void 0:r.id},data:{password:s,recover_password:""}});return a==null||delete a.password,{status:!1,message:f("SENHA ATUALIZADA COM SUCESSO."),data:a}})}static _FN_LOCAL_CHECK_IF_THIS_EMAIL_EXISTS(t){return n(this,null,function*(){return!!(yield l.user.findUnique({where:{email:t}}))})}},m(D,"UsuariosDatabase"),D);var L,x=(L=class{static CreateNewUser(t,e){return n(this,null,function*(){let{email:r,password:s,access_role:a}=t.body,c=yield U.register(r,s,a);return e.json(c)})}static Login(t,e){return n(this,null,function*(){let{email:r,password:s}=t.body,a=yield U.login(r,s);return e.json(a)})}static recover_password(t,e){return n(this,null,function*(){let{email:r}=t.body,s=yield U.recovery_password(r);return e.json(s)})}static update_recover_password(t,e){return n(this,null,function*(){let{uuid:r}=t.params,{new_password:s}=t.body,a=yield U.update_password(r,s);return e.json(a)})}},m(L,"UsersController"),L);var ft=require("jsonwebtoken");var M=m((o,t,e)=>n(void 0,null,function*(){let r=o.headers.authorization;if(!r)return t.status(401).json({err:!0,jwt:!0,message:S});let[,s]=r.split(" ");try{let a=(0,ft.verify)(s,String(process.env.JWT_STRING));return console.log(JSON.parse(a.user)),o.user=JSON.parse(a.user),e()}catch(a){return t.status(401).json({err:!0,jwt:!0,message:S+"CATCH"})}}),"Auth");var F,_t=(F=class{static create(t,e,r,s,a,c){return n(this,null,function*(){console.log(t);try{let u=yield l.establishment.create({data:{userId:t,name:e,number_phone:r,number_code:s,seller_code:a,description:c}});return{status:!0,message:E,data:u}}catch(u){return{status:!0,message:u,data:[]}}})}},m(F,"EstabalecimentosDatabase"),F);var H,gt=(H=class{static create(t,e){return n(this,null,function*(){console.log("ops");let r=t.user.code_ref_user,{name:s,userId:a,number_phone:c,number_code:u,description:d}=t.body,i=yield _t.create(a,s,c,u,r,d);e.json(i)})}},m(H,"EstablishmentController"),H);var j,wt=(j=class{static create(t,e,r,s,a,c,u,d,i,p){return n(this,null,function*(){try{let b=yield l.address.create({data:{cep:t,state:e,city:r,neighborhood:s,street:a,number:c,geographic_location:u,latitude:d,longitude:i,establishmentId:p}});return{status:!1,message:E,data:b}}catch(b){return console.log(b),{status:!0,message:S,data:[]}}})}},m(j,"EnderecosDatabase"),j);var B,yt=(B=class{static create(t,e){return n(this,null,function*(){let{cep:r,state:s,city:a,neighborhood:c,street:u,number:d,geographic_location:i,latitude:p,longitude:b}=t.body,{establishmentId:V}=t.params,J=yield wt.create(r,s,a,c,u,d,i,p,b,Number(V));e.json(J)})}},m(B,"AdressesController"),B);var k,Ct=(k=class{static init(t,e){return n(this,null,function*(){var et,st,rt;let r=t.params.id,s=yield l.bet.findMany({where:{number_game_result:String(r),AND:{hits_round:{gte:4},AND:{awarded:!0}}}}),a=s.map(Ot=>Ot.hits);for(var c={},u=0;u<a.length;u++){var d=a[u];c[d]?c[d]++:c[d]=1}let i=yield l.award.findFirst({where:{gamer_ref:Number(r)}}),p=Number(i==null?void 0:i.subtract_premiums),b=(et=c[4])!=null?et:0,V=(st=c[5])!=null?st:0,J=(rt=c[6])!=null?rt:0;console.log("QUATRO: ",b),console.log("CINCO: ",V),console.log("SEIS: ",J),console.log("ANTES: ",p);let Q=0,Z=0,tt=0;b!=0&&(Q=Number(i==null?void 0:i.block)/b,p=Number(p)-Number(i==null?void 0:i.block)),console.log("MEIO1: ",p),V!=0&&(Z=Number(i==null?void 0:i.corner)/b,p=Number(p)-Number(i==null?void 0:i.corner)),J!=0&&(tt=Number(i==null?void 0:i.seine)/b,p=Number(p)-Number(i==null?void 0:i.seine)),console.log("divisaoFour: ",Q.toFixed(2)),console.log("divisaoFive: ",Z.toFixed(2)),console.log("divisaoSix: ",tt.toFixed(2)),console.log("DEPOIS: ",p.toFixed(2));let vt=p>0?p:50;console.log(vt.toFixed(2)),e.json({totalValues:p,award:i,quantidade:a,betContent:s})})}},m(k,"ExemploController"),k);var G,At=(G=class{static depositar(t){return n(this,null,function*(){let e=yield l.award.findFirst({where:{is_completed:"IN_PROCESSING"},orderBy:{gamer_ref:"desc"},take:1}),r=e==null?void 0:e.id,s=Number(e==null?void 0:e.subtract_premiums)+Number(t),a=yield l.award.update({where:{id:r},data:{subtract_premiums:s,seine:Number(s)*75/100,corner:Number(s)*15/100,block:Number(s)*10/100,home_deposit:Number(t)}});return console.log(a),a})}},m(G,"DepositarDinheiroManualAdminServices"),G);var P,Nt=(P=class{static create(t,e){return n(this,null,function*(){var r;try{let{amount:s}=(r=t.body)!=null?r:50,a=yield At.depositar(Number(s));return t.io.emit("/BUSCAR_VALORES_APOSTA",{subtract_premiums:a==null?void 0:a.subtract_premiums,seine:a==null?void 0:a.seine,corner:a==null?void 0:a.corner,block:a==null?void 0:a.block}),e.json(a)}catch(s){return e.json(s)}})}},m(P,"DepositarDinheiroManualAdminController"),P);var h=(0,It.Router)();h.get("/v1/check/:numbers",W.check);h.get("/maior",W.maior);h.post("/v1/bet",M,mt.create);h.post("/v1/users/register",x.CreateNewUser);h.post("/v1/users/login",x.Login);h.post("/v1/recover-password",x.recover_password);h.post("/v1/recover-password/:uuid",x.update_recover_password);h.post("/v1/establishment",M,gt.create);h.post("/v1/adresses/:establishmentId",yt.create);h.post("/v1/auth/verify",M,(o,t)=>{console.log(o.user),t.send(o.user)});h.post("/v1/app-diversity/establishment",M,(o,t)=>{t.send({user:o.user})});h.get("/exemplo/:id",Ct.init);h.post("/v1/adiciona-dinheiro",Nt.create);0&&(module.exports={r});
